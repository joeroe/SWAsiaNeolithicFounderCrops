---
title: '"Founder Crops" in the Neolithic of Southwest Asia – Data Analysis'
subtitle: "Data analysis"
author:
  - first_name: "Joe"
    last_name: "Roe"
    url: https://joeroe.io
    affiliation: University of Copenhagen
    orcid_id: 0000-0002-1011-1244
  - first_name: "Amaia"
    last_name: "Arranz Otaegui"
    affiliation: Muséum National d'Histoire Naturelle, Paris
    orcid_id: 0000-0002-5091-6426
date: "`r Sys.Date()`"
output: 
  distill::distill_article:
    toc: true
    toc_depth: 4
bibliography: references.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE
)
```

```{r deps}
library("tidyverse")
library("SWAsiaNeolithicFounderCrops")
library("swapdata")
library("sf")
library("here")
library("gt")
library("glue")
```

This research compendium accompanies the paper `...`.

## Materials

### Study region and period

```{r region, warning=FALSE, results='hide', fig.cap='Study region.'}
sw_asia <- st_read(here("analysis/data/raw_data/regions/swasia.geojson"))

coast <- rnaturalearth::ne_coastline(scale = 50, returnclass = "sf")
coast <- st_crop(coast, sw_asia)

ggplot() +
  geom_sf(data = sw_asia) +
  geom_sf(data = coast)
```

We aimed to collate archaeobotanical data from Southwest Asia (fig. \@ref(fig:region)) during from the Neolithic to Chalcolithic period, c. 11.700 – 5000 BP.

```{r periods, fig.cap='Definition of cultural periods used in the analysis.'}
periods <- tribble(
  ~period,           ~agriculture,                    ~start_bp, ~end_bp,
  "Epipalaeolithic", "Foraging",                      25000,     11700,
  "PPNA",            "Pre-domestication cultivation", 11700,     10700,
  "EPPNB",           "Domestication",                 10700,     10200,
  "MPPNB",           "Domestication",                 10200,     9500,
  "LPPNB",           "Agriculture",                   9500,      8500,
  "Late Neolithic",  "Agriculture",                   8500,      6500,
  "Chalcolithic",    "Agriculture",                   6500,      5000,
  "Later",           "Agriculture",                   5000,      0
)

periods %>% 
  gt() %>% 
  cols_label(period = "Period", agriculture = "Agricultural stage",
             start_bp = "Start (cal BP)", end_bp = "End (cal BP")
```

### Archaeobotanical data

We collated data from three large-scale archaeobotanical databases: ORIGINS [@Wallace2018], and COMPAG [@Lucas2018; @Fuller2018], and ADEMNES [@Riehl2005].

Notes on collation:

* Standardised site names
* When sites were in multiple databases, preferred records from the most detailed/recent one (i.e. ORIGINS > COMPAG > ADEMNES)
* Some sites in ADEMNES have an N/prop. of 0 for all taxa. I assumed this meant that they were present but that quantification data was not available.
* ORIGINS is recorded by sample; COMPAG and ADEMNES by phases. Aggregated ORIGINS by phase for comparability, and because individual samples are more likely to be 'noisy'
* Calculated phase-level proportions for COMPAG

We filtered this data to include only samples from our region (Southwest Asia) and period (11,700–5000 BP) of interest,
with a buffer of ±2,000 years to reduce "edge effects" in our time series analyses.

```{r data-flora}
start_bp <- periods$start_bp[periods$period == "PPNA"]
end_bp <- periods$end_bp[periods$period == "Chalcolithic"]
flora <- collate_flora(
  origins_path = here("analysis/data/raw_data/origins/"),
  ademnes_path = here("analysis/data/raw_data/ademnes"),
  compag_path = here("analysis/data/raw_data/compag2018"),
  region = sw_asia,
  start_bp = start_bp + 1000,
  end_bp = end_bp - 1000
)

# TODO: check if affected by duplicate sample names between sites
n_phases <- length(unique(flora$phase_code))
n_sites <- length(unique(flora$site_name))
```

The resulting collated dataset (included as supplement?) includes archaeobotanical assemblages representing `r n_phases` distinct phases from `r n_sites` sites.

### Chronology

All three databases include rough calibrated date ranges for each sample, so we will use that for now.
We might look into using actual radiocarbon dates and incorporating the associated uncertainty into the analysis.

Using this data, each phase was classified into one of the periods defined above using its mid-point date.

```{r sample-periods}
flora <- mutate(
  flora,
  age_mid = age_end + ((age_start - age_end) / 2),
  period = cut(-age_mid, 
               breaks = -c(periods$start_bp, last(periods$end_bp)), 
               labels = periods$period,
               ordered_result = TRUE)
)

flora %>% 
  distinct(period, site_name, phase) %>% 
  add_count(period, name ="n_phases") %>% 
  distinct(period, site_name, n_phases) %>% 
  add_count(period, name = "n_sites") %>% 
  distinct(period, n_phases, n_sites) %>% 
  select(period, n_sites, n_phases) %>% 
  arrange(period) %>%
  gt() %>% 
  cols_label(period = "Period", n_sites = "Sites", n_phases = "Assemblages") 
```

## Results

### Occurrence of the founder crops

* Number & proportion of sites with founder crops reported
  * By period
* Number & proportion of sites with founder crops above P


### Founder crops through time

absolute counts (separating PPNA, PPNB-PPNC and PN), similar to the diagram in Quaternary Science Reviews but including the Pottery Neolithic. 
It would also be cool to do it by species, to see how the exploitation for each of the taxa increase/decreases over time.
I.e. vertical axis (absolute counts), horizontal axis (time), species represented by different colors?


### Other categories through time

* Grasses over time, based on counts (separating PPNA, PPNB-PPNC and PN).
Separating the different species listed in the table.
* Legumes over time, based on counts (separating PPNA, PPNB-PPNC and PN).
Separating the different species listed in the table.
* "wild plants" over time, based on counts (separating PPNA, PPNB-PPNC and PN). Separating the different species listed in the table.
* Fruits and nuts over time, based on counts (separating PPNA, PPNB-PPNC and PN). Separating the different species listed in the table.


### Earliest attested occurrence

-Chronology for the appearance of T. aestivum/durum. 
Reference to 2-3 sites.

-Chronology for the appearance of T. spelta in southwest Asia.
Reference to 2-3 sites.

-Hordeum spontaneum/vulgare (wild/domestic barley). 
Reference to 2-3 Pottery Neolithic sites where barley remains are found in significant amounts.

-Avena (include the different species)
Reference to 2-3 sites where oat remains are significant (I have Gilgal so far…) 

-T. monococcum 1 grained
Reference to 2-3 sites contemporary to Çatal Höyuk or later, specially Pottery Neolithic, where one-grained einkorn is found at a significant amount.

-Flax.
Reference to sites with evidence of flax.
